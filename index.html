<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepAI Image Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #4a5568;
            font-size: 2.5rem;
        }

        .api-key-section {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .api-key-section h3 {
            margin-bottom: 10px;
            color: #4a5568;
        }

        .system-prompt-section {
            background: #fff5eb;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #ed8936;
        }

        .system-prompt-section h3 {
            margin-bottom: 10px;
            color: #dd6b20;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        textarea, input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        textarea:focus, input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .system-prompt {
            min-height: 120px;
            font-family: monospace;
            font-size: 14px;
            background: #fefcbf;
        }

        .dimensions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            border: 2px dashed #e2e8f0;
            border-radius: 8px;
            text-align: center;
        }

        .result h3 {
            margin-bottom: 15px;
            color: #4a5568;
        }

        .generated-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
            transition: transform 0.3s ease;
        }

        .generated-image:hover {
            transform: scale(1.02);
        }

        .image-info {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: left;
        }

        .image-info p {
            margin: 5px 0;
            font-family: monospace;
            font-size: 14px;
        }

        .prompt-preview {
            background: #e6fffa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #38b2ac;
        }

        .prompt-preview h4 {
            color: #2c7a7b;
            margin-bottom: 10px;
        }

        .prompt-preview-content {
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #c53030;
        }

        .success {
            background: #c6f6d5;
            color: #2d7d32;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2d7d32;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .share-button {
            padding: 10px 20px;
            background: #e2e8f0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .share-button:hover {
            background: #cbd5e0;
        }

        .curl-command {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: nowrap;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .dimensions {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .share-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® DeepAI Image Generator</h1>
        
        <div class="api-key-section">
            <h3>üîë API Key</h3>
            <div class="form-group">
                <label for="apiKey">Your DeepAI API Key:</label>
                <input 
                    type="password" 
                    id="apiKey" 
                    placeholder="Enter your DeepAI API key here..."
                    value=""
                >
                <small style="color: #718096; font-size: 12px; display: block; margin-top: 5px;">
                    Get your API key from <a href="https://deepai.org/" target="_blank">deepai.org</a>
                </small>
            </div>
        </div>

        <div class="system-prompt-section">
            <h3>‚öôÔ∏è System Prompt</h3>
            <div class="form-group">
                <label for="systemPrompt">System Instructions:</label>
                <textarea 
                    id="systemPrompt" 
                    class="system-prompt"
                    placeholder="Enter system instructions that will be combined with your prompt..."
                >Create a UGC lifestyle photography image with the following specifications:

STYLE: UGC lifestyle photography, casual and authentic, smartphone-shot aesthetic, natural lighting

MODELS:
- Female (20-35): genuine smile, approachable, trustworthy, casual everyday wear
- Male (20-35): confident, friendly, relatable, modern casual or streetwear

PRODUCT FOCUS: Natural usage, product held, applied, or integrated in a lifestyle setting. Product should look like part of daily routine, not forced.

BACKGROUND: Realistic everyday settings such as living room, coffee shop, work desk, or outdoors

CAMERA: Eye level or handheld POV, close-up on model and product, natural framing, high resolution but natural, not overly polished

BRANDING: Relatable, positive, authentic tone. Warm, friendly, aspirational mood. Model appears as if recommending product to a friend.

USER REQUEST: </textarea>
            </div>
        </div>

        <form id="imageForm">
            <div class="form-group">
                <label for="prompt">Your Prompt:</label>
                <textarea 
                    id="prompt" 
                    placeholder="Enter your specific image request..."
                    required
                >A person using a smartphone to take photos in a coffee shop</textarea>
            </div>

            <div class="form-group dimensions">
                <div>
                    <label for="width">Width:</label>
                    <input type="number" id="width" value="512" min="64" max="1024" step="64">
                </div>
                <div>
                    <label for="height">Height:</label>
                    <input type="number" id="height" value="512" min="64" max="1024" step="64">
                </div>
            </div>

            <div class="form-group">
                <label for="version">Model Version:</label>
                <select id="version">
                    <option value="standard">Standard</option>
                    <option value="hd">HD</option>
                    <option value="genius">Genius</option>
                </select>
            </div>

            <div class="form-group">
                <label for="negativePrompt">Negative Prompt (optional):</label>
                <input 
                    type="text" 
                    id="negativePrompt" 
                    placeholder="What to avoid in the image (blurry, distorted, etc)..."
                >
            </div>

            <button type="submit" id="generateBtn">Generate Image</button>
        </form>

        <div id="promptPreview" class="prompt-preview" style="display: none;">
            <h4>üìù Combined Prompt (System + User):</h4>
            <div class="prompt-preview-content" id="combinedPromptPreview"></div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Generating your image... This may take 30-60 seconds.</p>
        </div>

        <div id="result" class="result" style="display: none;">
            <!-- Results will be inserted here -->
        </div>

        <div id="error" class="error" style="display: none;">
            <!-- Error messages will be inserted here -->
        </div>

        <div id="curlSection" style="display: none;">
            <h3>üîß cURL Command</h3>
            <div class="curl-command" id="curlCommand"></div>
        </div>
    </div>

    <script>
        const form = document.getElementById('imageForm');
        const generateBtn = document.getElementById('generateBtn');
        const loading = document.getElementById('loading');
        const result = document.getElementById('result');
        const error = document.getElementById('error');
        const curlSection = document.getElementById('curlSection');
        const curlCommand = document.getElementById('curlCommand');
        const promptPreview = document.getElementById('promptPreview');
        const combinedPromptPreview = document.getElementById('combinedPromptPreview');

        // Function to combine system prompt with user prompt
        function combinePrompts(systemPrompt, userPrompt) {
            // Remove any trailing whitespace from system prompt and add space if needed
            const cleanSystemPrompt = systemPrompt.trim();
            const cleanUserPrompt = userPrompt.trim();
            
            // Combine them with proper spacing
            if (cleanSystemPrompt.endsWith(':')) {
                return `${cleanSystemPrompt} ${cleanUserPrompt}`;
            } else if (cleanSystemPrompt.endsWith('-')) {
                return `${cleanSystemPrompt} ${cleanUserPrompt}`;
            } else {
                return `${cleanSystemPrompt}: ${cleanUserPrompt}`;
            }
        }

        // Show preview of combined prompt
        function updatePromptPreview() {
            const systemPrompt = document.getElementById('systemPrompt').value;
            const userPrompt = document.getElementById('prompt').value;
            
            if (systemPrompt && userPrompt) {
                const combined = combinePrompts(systemPrompt, userPrompt);
                combinedPromptPreview.textContent = combined;
                promptPreview.style.display = 'block';
            } else {
                promptPreview.style.display = 'none';
            }
        }

        // Add event listeners to update preview
        document.getElementById('systemPrompt').addEventListener('input', updatePromptPreview);
        document.getElementById('prompt').addEventListener('input', updatePromptPreview);

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Hide previous results and errors
            result.style.display = 'none';
            error.style.display = 'none';
            curlSection.style.display = 'none';
            
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                showError('Please enter your DeepAI API key');
                return;
            }

            const userPrompt = document.getElementById('prompt').value.trim();
            if (!userPrompt) {
                showError('Please enter a prompt');
                return;
            }

            // Show loading state
            loading.style.display = 'block';
            generateBtn.disabled = true;

            const systemPrompt = document.getElementById('systemPrompt').value.trim();
            const width = parseInt(document.getElementById('width').value);
            const height = parseInt(document.getElementById('height').value);
            const version = document.getElementById('version').value;
            const negativePrompt = document.getElementById('negativePrompt').value;

            try {
                // Combine system prompt with user prompt
                const combinedPrompt = combinePrompts(systemPrompt, userPrompt);
                console.log('Combined prompt:', combinedPrompt);

                // Create FormData for the direct DeepAI API call
                const formData = new FormData();
                formData.append('text', combinedPrompt);
                formData.append('width', width.toString());
                formData.append('height', height.toString());
                formData.append('image_generator_version', version);
                
                if (negativePrompt) {
                    formData.append('negative_prompt', negativePrompt);
                }

                const response = await fetch('https://api.deepai.org/api/text2img', {
                    method: 'POST',
                    headers: {
                        'api-key': apiKey,
                    },
                    body: formData,
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || data.message || `HTTP error! status: ${response.status}`);
                }

                if (data.output_url) {
                    displayResult(data, combinedPrompt, width, height, version, userPrompt);
                    generateCurlCommand(apiKey, combinedPrompt, width, height, version, negativePrompt);
                } else {
                    throw new Error('No image URL returned from API');
                }

            } catch (err) {
                showError(err.message);
            } finally {
                loading.style.display = 'none';
                generateBtn.disabled = false;
            }
        });

        function displayResult(data, combinedPrompt, width, height, version, originalUserPrompt) {
            result.innerHTML = `
                <div class="success">
                    <h3>‚úÖ Image Generated Successfully!</h3>
                    <p>Your image has been created using DeepAI's API</p>
                </div>
                <img src="${data.output_url}" alt="Generated image" class="generated-image" 
                     onerror="this.style.display='none'; document.getElementById('imageError').style.display='block'">
                <div id="imageError" class="error" style="display: none;">
                    Failed to load image. You can <a href="${data.output_url}" target="_blank">view it directly here</a>.
                </div>
                <div class="prompt-preview">
                    <h4>üìù Prompt Used:</h4>
                    <div class="prompt-preview-content">${combinedPrompt}</div>
                </div>
                <div class="image-info">
                    <p><strong>ID:</strong> ${data.id}</p>
                    <p><strong>Output URL:</strong> <a href="${data.output_url}" target="_blank">${data.output_url.substring(0, 50)}...</a></p>
                    ${data.share_url ? `<p><strong>Share URL:</strong> <a href="${data.share_url}" target="_blank">${data.share_url.substring(0, 50)}...</a></p>` : ''}
                    <p><strong>Dimensions:</strong> ${width} √ó ${height}</p>
                    <p><strong>Model:</strong> ${version}</p>
                    <p><strong>User Prompt:</strong> ${originalUserPrompt.substring(0, 100)}${originalUserPrompt.length > 100 ? '...' : ''}</p>
                </div>
                <div class="share-buttons">
                    <button class="share-button" onclick="copyToClipboard('${data.output_url}')">
                        üìã Copy Image URL
                    </button>
                    <button class="share-button" onclick="downloadImage('${data.output_url}', '${data.id}')">
                        üíæ Download Image
                    </button>
                    <a href="${data.output_url}" target="_blank" class="share-button">
                        üîó Open Image
                    </a>
                    ${data.share_url ? `<a href="${data.share_url}" target="_blank" class="share-button">üåê Share Page</a>` : ''}
                </div>
            `;
            result.style.display = 'block';
        }

        function generateCurlCommand(apiKey, combinedPrompt, width, height, version, negativePrompt) {
            let curl = `curl -X POST \\\n  -F 'text="${combinedPrompt.replace(/'/g, "'\\''")}"' \\\n  -F 'width=${width}' \\\n  -F 'height=${height}' \\\n  -F 'image_generator_version=${version}'`;
            
            if (negativePrompt) {
                curl += ` \\\n  -F 'negative_prompt="${negativePrompt.replace(/'/g, "'\\''")}"'`;
            }
            
            curl += ` \\\n  -H 'api-key:${apiKey}' \\\n  https://api.deepai.org/api/text2img`;
            
            curlCommand.textContent = curl;
            curlSection.style.display = 'block';
        }

        function showError(message) {
            error.innerHTML = `
                <h3>‚ùå Error</h3>
                <p>${message}</p>
                <p>Please check your inputs and try again.</p>
            `;
            error.style.display = 'block';
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

        function downloadImage(url, filename) {
            fetch(url)
                .then(response => response.blob())
                .then(blob => {
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `deepai-image-${filename}.jpg`;
                    link.click();
                    URL.revokeObjectURL(link.href);
                })
                .catch(err => {
                    console.error('Download failed:', err);
                    alert('Download failed. You can right-click the image and "Save as..." instead.');
                });
        }

        // Initialize prompt preview
        updatePromptPreview();

        // Try to load API key from localStorage
        const savedApiKey = localStorage.getItem('deepai_api_key');
        if (savedApiKey) {
            document.getElementById('apiKey').value = savedApiKey;
        }

        // Save API key when changed
        document.getElementById('apiKey').addEventListener('input', (e) => {
            localStorage.setItem('deepai_api_key', e.target.value);
        });

        // Save system prompt to localStorage
        document.getElementById('systemPrompt').addEventListener('input', (e) => {
            localStorage.setItem('deepai_system_prompt', e.target.value);
        });

        // Load saved system prompt
        const savedSystemPrompt = localStorage.getItem('deepai_system_prompt');
        if (savedSystemPrompt) {
            document.getElementById('systemPrompt').value = savedSystemPrompt;
        }
    </script>
</body>
</html>